#!/usr/bin/env python3
import sys
from os import walk
from os import path
from os import chdir
from functools import reduce

# produces an index. Format:
# <total count> <total size>
# <size> <path>
# <size> <path>
# ...


if len(sys.argv) != 2:
    print("Usage: %s <root>" % sys.argv[0])
    sys.exit(1)

root = sys.argv[1]

chdir(root)

# list of tuples: (size, path)
file_list: list[tuple[int, str]] = []

for dirpath, dirnames, filenames in walk(root):
    for filename in filenames:
        filepath = path.join(dirpath, filename)

        try:
            size = path.getsize(filepath)
        except FileNotFoundError:
            continue

        file_list.append((size, filepath))

# biggest first (user probably wants media, not .c files from some random repository)
file_list.sort(key=lambda x: x[0], reverse=True)

total_size = reduce(lambda acc, item: acc + item[0], file_list, 0)

print("%d %d" % (len(file_list), total_size))

for size, filepath in file_list:
    print("%d %s" % (size, filepath))
